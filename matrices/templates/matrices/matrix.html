{% extends 'includes/base.html' %}

{% load custom %}

{% load static %}

{% block content %}

	<ol id="sausage" class="breadcrumb">
	
		<li class="breadcrumb-item">
			<a href="{% url 'matrices:home' %}">
				Home
			</a>
		</li>
	
		<li class="breadcrumb-item">
			<a href="{% url 'matrices:index' %}">
				Workbenches
			</a>
		</li>
	
		<li class="breadcrumb-item active">
			CPW:{{ matrix.id|stringformat:"06d" }}
		</li>
	
	</ol>

{% if rows %}

	<div id="matrix_blind">

		<dl class="row">

			<dt class="col-sm-2">Id:</dt>
			<dd class="col-sm-2">CPW:{{ matrix.id|stringformat:"06d" }}</dd>

			<dt class="col-sm-2">Title:</dt>
			<dd class="col-sm-6">{{ matrix.title }}</dd>

			<dt class="col-sm-2">Owner:</dt>
			<dd class="col-sm-2">{{ owner.username }}</dd>
			
			<dt class="col-sm-2">Created:</dt>
			<dd class="col-sm-2"></dd>
			
			<dt class="col-sm-2">Last Modified:</dt>
			<dd class="col-sm-2"></dd>

			<dt class="col-sm-2">Description:</dt>
			<dd class="col-sm-10">{{ matrix.description|truncatechars:125 }}</dd>
		</dl>

	</div>
	
	
		<div class="table-responsive">
	
			<table id="myTable" class="test">
		
				<tbody>
		
	{% for row in rows %}

					<tr>
			
		{% for column in columns %}

	    	{% with matrix_cell=matrix_cells|index:forloop.parentloop.counter0|index:forloop.counter0 %}

				{% if matrix_cell.xcoordinate == 0 and matrix_cell.ycoordinate == 0 %}

						<td id="{{ matrix_cell.id }}">
				
							<div class="master">
				
								<div class="dropdown">
			
									<button class="btn btn-secondary btn-danger btn-sm" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
										<i class="fa fa-bars"></i>
									</button>
		
									<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">

										<a class="dropdown-item" href="{% url 'matrices:detail_matrix' matrix.id %}">
											<i class="fa fa-eye"></i> View Workbench Details
										</a>
					
					{% if matrix_link != '' %}

						{% if matrix.blogpost != '' %}

										<a class="dropdown-item" href="{% url 'matrices:detail_matrix_blog' matrix.id %}">
											<i class="fa fa-eye"></i> View Workbench Commentary
										</a>
					
						{% endif %}

					{% endif %}

					{% if user == owner %}
					
										<a class="dropdown-item" href="{% url 'matrices:edit_matrix' matrix.id %}">
											<i class="fa fa-pencil-alt"></i> Edit Workbench Details
										</a>

										<a class="dropdown-item" href="{% url 'matrices:delete_matrix' matrix.id %}" onclick="return confirm('Are you sure you want to DELETE this MATRIX?')">
											<i class="fa fa-pencil-alt"></i> DELETE Workbench 
										</a>

										<a class="dropdown-item" href="{% url 'matrices:add_column' matrix.id %}">
											<i class="fa fa-angle-double-right"></i> APPEND Column
										</a>

										<a class="dropdown-item" href="{% url 'matrices:delete_column' matrix.id %}" onclick="return confirm('Are you sure you want to DELETE the last COLUMN?')">
											<i class="fa fa-angle-double-left"></i> Delete LAST Column
										</a>

										<a class="dropdown-item" href="{% url 'matrices:add_row' matrix.id %}">
											<i class="fa fa-angle-double-down"></i> APPEND Row
										</a>

										<a class="dropdown-item" href="{% url 'matrices:delete_row' matrix.id %}" onclick="return confirm('Are you sure you want to DELETE the last ROW?')">
											<i class="fa fa-angle-double-up"></i> Delete LAST Row
										</a>

					{% endif %}
									</div>

								</div>
		
							</div>

						</td>

				{% endif %}

				{% if matrix_cell.xcoordinate == 0 and matrix_cell.ycoordinate != 0 %}
					
						<td id="{{ matrix_cell.id }}">
				
							<div class="headrow">
			
								<div class="dropdown">

									<button class="btn btn-secondary btn-danger btn-sm" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
										<i class="fa fa-bars"></i>
									</button>
		
									<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">

										<a class="dropdown-item" href="{% url 'matrices:view_cell' matrix.id matrix_cell.id %}">
											<i class="fa fa-eye"></i> <em>{{ matrix_cell.title|truncatechars:20 }}</em>
										</a>
								
					{% if user == owner %}

										<a class="dropdown-item" href="{% url 'matrices:edit_cell' matrix.id matrix_cell.id %}">
											<i class="fa fa-pencil-alt"></i> Edit Row Header
										</a>

										<a class="dropdown-item" href="{% url 'matrices:add_row_above' matrix.id forloop.parentloop.counter0	%}">
											<i class="fa fa-angle-up"></i> Add Row Above
										</a>

										<a class="dropdown-item" href="{% url 'matrices:delete_this_row' matrix.id forloop.parentloop.counter0 %}" onclick="return confirm('Are you sure you want to DELETE this ROW?')">
											<i class="fa fa-trash-alt"></i> Delete This Row
										</a>

										<a class="dropdown-item" href="{% url 'matrices:add_row_below' matrix.id forloop.parentloop.counter0 %}">
											<i class="fa fa-angle-down"></i> Add Row Below
										</a>

					{% endif %}

									</div>
							
								</div>
		
								<em>{{ matrix_cell.title|truncatechars:5 }}</em>
						
							</div>

						</td>

				{% endif %}

				{% if matrix_cell.xcoordinate != 0 and matrix_cell.ycoordinate == 0 %}

						<td id="{{ matrix_cell.id }}">
				
							<div class="headcol" align="right">

								<div class="dropdown">

									<em>{{ matrix_cell.title|truncatechars:20 }}</em>

									<button class="btn btn-secondary btn-danger btn-sm" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
										<i class="fa fa-bars"></i>
									</button>
		
									<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">

										<a class="dropdown-item" href="{% url 'matrices:view_cell' matrix.id matrix_cell.id %}">
											<i class="fa fa-eye"></i> <em>{{ matrix_cell.title|truncatechars:20 }}</em>
										</a>

					{% if user == owner %}

										<a class="dropdown-item" href="{% url 'matrices:edit_cell' matrix.id matrix_cell.id %}">
											<i class="fa fa-pencil-alt"></i> Edit Column Header
										</a>

										<a class="dropdown-item" href="{% url 'matrices:add_column_left' matrix.id forloop.counter0	%}">
											<i class="fa fa-angle-left"></i> Add Column Left
										</a>

										<a class="dropdown-item" href="{% url 'matrices:delete_this_column' matrix.id forloop.counter0 %}" onclick="return confirm('Are you sure you want to DELETE this COLUMN?')">
											<i class="fa fa-trash-alt"></i> Delete This Column
										</a>

										<a class="dropdown-item" href="{% url 'matrices:add_column_right' matrix.id forloop.counter0 %}">
											<i class="fa fa-angle-right"></i> Add Column Right
										</a>

					{% endif %}

									</div>
						
								</div>

							</div>

						</td>

				{% endif %}

				{% if matrix_cell.xcoordinate != 0 and matrix_cell.ycoordinate != 0 %}

						<td id="{{ matrix_cell.id }}">
				
							<div class="cell" align="right">

								<div class="dropdown">

									<a id="dropdown_{{ matrix_cell.id }}" data-toggle="dropdown" class="dropdown-toggle">
										<b class="caret"></b>
									</a>
								
							        <ul class="dropdown-menu">

										<li>								
											<a class="dropdown-item" href="{% url 'matrices:view_cell' matrix.id matrix_cell.id %}">
												<i class="fa fa-eye"></i> <em>{{ matrix_cell.title|truncatechars:20 }}</em>
											</a>
										</li>								

					{% if matrix_link != '' %}

						{% if matrix_cell.blogpost != '' %}

										<li>								
											<a class="dropdown-item" href="{% url 'matrices:view_cell_blog' matrix.id matrix_cell.id %}">
												<i class="fa fa-eye"></i> View Cell Commentary
											</a>
										</li>								
					
						{% endif %}
		
					{% endif %}

					{% if user == owner %}

										<li>								
											<a class="dropdown-item" href="{% url 'matrices:edit_cell' matrix.id matrix_cell.id %}">
												<i class="fa fa-pencil-alt"></i> Edit Cell
											</a>
										</li>								

					{% endif %}

									</ul> 

								</div>

								<div style="width:175px; height:175px;" align="left">

					{% if matrix_cell.image %}
	
						{% if matrix_cell.image.roi == 0 %}
						
									<p>	
										<a href="{{ matrix_cell.image.viewer_url }}" target="_blank">
											<img src="{{ matrix_cell.image.birdseye_url }}" >
										</a>
									</p>

						{% else %}
	
									<p>	
										<a href="{{ matrix_cell.image.viewer_url }}" target="_blank">
											<img style="width:175px;" src="{{ matrix_cell.image.birdseye_url }}" >
										</a>
									</p>

									<!-- X: {{ matrix_cell.xcoordinate }}<br /> -->
									<!-- Y: {{ matrix_cell.ycoordinate }}<br /> -->
									<!-- {{ matrix_cell.id }}<br /> -->
									<!-- <em>{{ matrix_cell.title }}</em><br /> -->
									<!-- {{ matrix_cell.image.title }}<br /> -->
									<!-- {{ matrix_cell.image }} -->
						{% endif %}
	
					{% else %}

									<p class="text-left">
										<a href="#">
											<img style="width:170px; height:110px;" src="/static/ccp-logo.png">
											<!-- <img style="width:170px; height:110px;" src="/static/ccp-logo.png"> -->
										</a>
									</p>
							
								</div> 

					{% endif %}
	
							</div> 
							
						</td>

				{% endif %}

		
			{% endwith %}

		{% endfor %}

					</tr>								

	{% endfor %}

				</tbody>

			</table>
	
		</div>

{% else %}

		<h1>CPW:{{ matrix.id }}, "{{ matrix.title }}" has NO Cells</h1>

		<br />

		<table>

			<tr>

				<td>
	
					<form action="{% url 'matrices:add_cell' matrix.id %}" method="post">
{% csrf_token %}
						<input class="btn btn-danger" type="submit" value="Add Cell" />

					</form>

					<a href="{% url 'matrices:index' %}">
						<button class="save btn btn-success">Back</button>
					</a>
			
				</td>

			</tr>

		</table>

{% endif %}

		
{% endblock %}
